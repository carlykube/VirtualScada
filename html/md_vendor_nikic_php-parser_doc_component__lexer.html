<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>VirtualSCADA: Lexer component documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">VirtualSCADA
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">VirtualSCADA Senior Design Project</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_vendor_nikic_php-parser_doc_component__lexer.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Lexer component documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The lexer is responsible for providing tokens to the parser. The project comes with two lexers: <code><a class="el" href="namespace_php_parser.html">PhpParser</a>\Lexer</code> and <code><a class="el" href="namespace_php_parser.html">PhpParser</a>\Lexer\Emulative</code>. The latter is an extension of the former, which adds the ability to emulate tokens of newer <a class="el" href="namespace_p_h_p.html">PHP</a> versions and thus allows parsing of new code on older versions.</p>
<p>This documentation discusses options available for the default lexers and explains how lexers can be extended.</p>
<h2>Lexer options </h2>
<p>The two default lexers accept an <code>$options</code> array in the constructor. Currently only the <code>'usedAttributes'</code> option is supported, which allows you to specify which attributes will be added to the AST nodes. The attributes can then be accessed using <code>$node-&gt;getAttribute()</code>, <code>$node-&gt;setAttribute()</code>, <code>$node-&gt;hasAttribute()</code> and <code>$node-&gt;getAttributes()</code> methods. <a class="el" href="class_a.html">A</a> sample options array:</p>
<p>```php $lexer = new <a class="el" href="namespace_php_parser.html">PhpParser</a>(array( 'usedAttributes' =&gt; array( 'comments', 'startLine', 'endLine' ) )); ```</p>
<p>The attributes used in this example match the default behavior of the lexer. The following attributes are supported:</p>
<ul>
<li><code>comments</code>: Array of <code><a class="el" href="namespace_php_parser.html">PhpParser</a>\Comment</code> or <code><a class="el" href="namespace_php_parser.html">PhpParser</a>\Comment\Doc</code> instances, representing all comments that occurred between the previous non-discarded token and the current one. Use of this attribute is required for the <code>$node-&gt;getDocComment()</code> method to work. The attribute is also needed if you wish the pretty printer to retain comments present in the original code.</li>
<li><code>startLine</code>: Line in which the node starts. This attribute is required for the <code>$node-&gt;getLine()</code> to work. It is also required if syntax errors should contain line number information.</li>
<li><code>endLine</code>: Line in which the node ends.</li>
<li><code>startTokenPos</code>: Offset into the token array of the first token in the node.</li>
<li><code>endTokenPos</code>: Offset into the token array of the last token in the node.</li>
<li><code>startFilePos</code>: Offset into the code string of the first character that is part of the node.</li>
<li><code>endFilePos</code>: Offset into the code string of the last character that is part of the node.</li>
</ul>
<h3>Using token positions</h3>
<p>The token offset information is useful if you wish to examine the exact formatting used for a node. For example the AST does not distinguish whether a property was declared using <code>public</code> or using <code>var</code>, but you can retrieve this information based on the token position:</p>
<p>```php function isDeclaredUsingVar(array $tokens, <a class="el" href="namespace_php_parser.html">PhpParser</a> $prop) { $i = $prop-&gt;getAttribute('startTokenPos'); return $tokens[$i][0] === T_VAR; } ```</p>
<p>In order to make use of this function, you will have to provide the tokens from the lexer to your node visitor using code similar to the following:</p>
<p>```php class MyNodeVisitor extends <a class="el" href="namespace_php_parser.html">PhpParser</a> { private $tokens; public function setTokens(array $tokens) { $this-&gt;tokens = $tokens; }</p>
<p>public function leaveNode(<a class="el" href="namespace_php_parser.html">PhpParser</a> $node) { if ($node instanceof <a class="el" href="namespace_php_parser.html">PhpParser</a>) { var_dump(isDeclaredUsingVar($this-&gt;tokens, $node)); } } }</p>
<p>$lexer = new <a class="el" href="namespace_php_parser.html">PhpParser</a>(array( 'usedAttributes' =&gt; array( 'comments', 'startLine', 'endLine', 'startTokenPos', 'endTokenPos' ) )); $parser = new <a class="el" href="namespace_php_parser.html">PhpParser</a>($lexer);</p>
<p>$visitor = new MyNodeVisitor(); $traverser = new <a class="el" href="namespace_php_parser.html">PhpParser</a>(); $traverser-&gt;addVisitor($visitor);</p>
<p>try { $stmts = $parser-&gt;parse($code); $visitor-&gt;setTokens($lexer-&gt;getTokens()); $stmts = $traverser-&gt;traverse($stmts); } catch (<a class="el" href="namespace_php_parser.html">PhpParser</a> $e) { echo 'Parse <a class="el" href="class_error.html">Error</a>: ', $e-&gt;getMessage(); } ```</p>
<p>The same approach can also be used to perform specific modifications in the code, without changing the formatting in other places (which is the case when using the pretty printer).</p>
<h2>Lexer extension </h2>
<p><a class="el" href="class_a.html">A</a> lexer has to define the following public interface: </p><pre class="fragment">void startLexing(string $code);
array getTokens();
string handleHaltCompiler();
int getNextToken(string &amp;$value = null, array &amp;$startAttributes = null, array &amp;$endAttributes = null);
</pre><p>The <code>startLexing()</code> method is invoked with the source code that is to be lexed (including the opening tag) whenever the <code><a class="el" href="d3_8min_8js.html#ae83605c3912b7dd2017d8889154727ad">parse()</a></code> method of the parser is called. It can be used to reset state or preprocess the source code or tokens.</p>
<p>The <code>getTokens()</code> method returns the current token array, in the usual <code>token_get_all()</code> format. This method is not used by the parser (which uses <code>getNextToken()</code>), but is useful in combination with the token position attributes.</p>
<p>The <code>handleHaltCompiler()</code> method is called whenever a <code>T_HALT_COMPILER</code> token is encountered. It has to return the remaining string after the construct (not including <code>();</code>).</p>
<p>The <code>getNextToken()</code> method returns the ID of the next token (as defined by the <code>Parser::T_*</code> constants). If no more tokens are available it must return <code>0</code>, which is the ID of the <code>EOF</code> token. Furthermore the string content of the token should be written into the by-reference <code>$value</code> parameter (which will then be available as <code>$n</code> in the parser).</p>
<h3>Attribute handling</h3>
<p>The other two by-ref variables <code>$startAttributes</code> and <code>$endAttributes</code> define which attributes will eventually be assigned to the generated nodes: The parser will take the <code>$startAttributes</code> from the first token which is part of the node and the <code>$endAttributes</code> from the last token that is part of the node.</p>
<p>E.g. if the tokens `T_FUNCTION T_STRING ... '{' ... '}'<code>constitute a node, then the</code>$startAttributes<code>from the </code>T_FUNCTION<code>token will be taken and the</code>$endAttributes<code>from the</code>'}'` token.</p>
<p>An application of custom attributes is storing the original formatting of literals: The parser does not retain information about the formatting of integers (like decimal vs. hexadecimal) or strings (like used quote type or used escape sequences). This can be remedied by storing the original value in an attribute:</p>
<p>```php class KeepOriginalValueLexer extends PHPParser // or PHPParser { public function getNextToken(&amp;$value = null, &amp;$startAttributes = null, &amp;$endAttributes = null) { $tokenId = parent::getNextToken($value, $startAttributes, $endAttributes);</p>
<p>if ($tokenId == PHPParser::T_CONSTANT_ENCAPSED_STRING // non-interpolated string || $tokenId == PHPParser::T_LNUMBER // integer || $tokenId == PHPParser::T_DNUMBER // floating point number ) { // could also use $startAttributes, doesn't really matter here $endAttributes['originalValue'] = $value; }</p>
<p>return $tokenId; } } ``` </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Apr 14 2015 18:33:05 for VirtualSCADA by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
